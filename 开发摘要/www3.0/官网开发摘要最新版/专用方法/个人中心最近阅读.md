<!-- 作者：胡铁平
日期：2019-12-8 -->

# 个人中心

<!-- 个人中心，统一的权限判断在哪里？ -->
- 中间件处理token，如果登录过期或者没有用户信息，重定向到登录页面

## 最近阅读

### 最近阅读前端

- 操作： 跳转个人中心时默认显示最近阅读列表
- 请求地址： /user

### 最近阅读后端（同步渲染） ROUTER

- 请求方法：GET
- 参数：(searchType, currentPage)
- 路由： /user
   <!-- 参数对吗？够吗？ -->
    1. 调用getRecentReading(searchType, currentPage = 1)
    2. 根据返回结果
      1. 成功：有返回否则渲染最近阅读页面
       <!-- 2. 无法获得NOT_FOUND -->
      2. 异常：渲染错误页面；请求资源不存在渲染404页面；其他异常渲染500页面

- model：customer、readingLogs

#### 最近阅读获取业务逻辑 BLL

参数：

- searchType：String格式，阅读记录类型(默认精品报告)，必填
<!-- 不填写，默认？ -->
- currentPage：Number格式，当前页，选填,不填写默认为1

过程
<!-- 到底应该在哪里判断权限与身份？ -->
  1. 中间件判断用户权限与身份
  2. 根据用户id查找最近阅读记录
     1. 如果存在阅读记录，返回阅读记录的briefId数组[]
   <!-- 不存在算不算异常？ -->
     2. 如果不存在阅读记录
        1. 查询到的阅读记录为空，跳出流程（用户暂时没有阅读记录，正常）
        2. 捕获到异常抛出异常对象：DB_ERR: [2000, '数据库操作异常']（数据库错误异常）
  3. 根据步骤2结果，如果返回数组为空返回空数组，否则往下执行
     1. 通过阅读记录的brieIid数组查找es数据库
        1. 如果查到报告，返回报告的对象数组[{brief}...]
   <!-- 没有找到数据，可能是什么情况？是否有必要引发异常？ -->
        1. 如果未查到报告
           1. 查找到的报告列表为空，返回空数组
              1.  查找到的报告列表为空可能是mongo和ES数据库数据没有同步，导致briefId在ES中找不到对应的brief
           2. 捕获到异常抛出异常对象：DB_ERR: [2000, '数据库操作异常']
  4. 返回获取到的报告列表

返回数据
<!-- 返回什么内容？readinglog和user是什么意思？ -->
- 成功：[{readingLog}...], {user}, {标准分页对象}
  - [{readingLog}...]：最近阅读对象数组， user：用户信息
- 失败：返回错误信息
