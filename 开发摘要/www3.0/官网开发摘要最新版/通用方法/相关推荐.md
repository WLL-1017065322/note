<!-- 作者：胡铁平 -->
<!-- 日期：2019.12.08 -->

<!-- 先描述公共方法所使用的（已知的）业务场景 -->
# 相关推荐

场景：

- 场景1：数、图、专、政详情右上角，显示与详情页相关的当前类型和报告类型的推荐列表
- 场景2：新闻详情页的右上角，显示与当前新闻相关的报告

设计概要：
简要归纳函数对主要作用

- 根据传入的类型和id,返回相关推荐的列表
  1. 数图专政：返回对应类型对象和报告类型对象的组合列表
  2. 新闻：放回当前新闻相关的新闻对象列表

参数：

- type: String格式，查看的详情类型
- id: ObjectId格式，浏览详情的id

过程：

  1. 根据id查找单一内容类缓存库
  2. 如有对应value，直接返回缓存中的value，否则往下执行：
      1.1. 如果传入的type属于数图专政
         1. 拿到相关推荐的brief
            a. 根据id查找ES中的section {atachemnt: {subObject: id}}
               1. 如果未找到section，说明当前对象没有关联报告，跳转步骤c
               2. 如果有section对象，获取section对应brief的行业
               3. 根据行业在ES数据库中查10条相关行业的brief
            b. 如果获取到brief数组，判断数组是否等于10条
               1. 如果等于10条，返回brief数组
               2. 如果小于10条，在热门报告中拿几条附加到brief数组
            c. 如果未获取的brief数组为空，在热门报告中拿10条附加到brief数组
            d. 随机在brief数组中取5条数据
         2. 拿到相关推荐的原类型数组
            1. 如果原类型有行业(数、专、政、新闻)，根据行业名在ES数据库中查找10条数据，然后随机取5条
            2. 如果源类型没有行业(图说)，根据id找到对应ill
               1. 通过BriefId找到关联的brief
                  1. 如果ill有关联brief，查找brief下面的图说数组
                     1. 在获取到的数组中去除当前图说，返回图说数组
                  2. 如果ill没有关联brief，在热门报告中取图书然后返回图说数组
      1.2. 以传入的id为key，返回的{brief数组, 原对象数组} 为value存入Redis的单一内容缓存中
      1.3. 更新关系映射缓存
         1. 以brief中的id为Key，查找映射缓存
         2. 以Id为value，加入到值中（set类型缓存值）
  3. 返回相关推荐列表

返回：[{{brief}，{原对象}}...] 返回报告和原对象组合的数组
